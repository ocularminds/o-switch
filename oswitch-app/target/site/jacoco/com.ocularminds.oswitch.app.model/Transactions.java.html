<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Transactions.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">oswitch-app</a> &gt; <a href="index.source.html" class="el_package">com.ocularminds.oswitch.app.model</a> &gt; <span class="el_source">Transactions.java</span></div><h1>Transactions.java</h1><pre class="source lang-java linenums">package com.ocularminds.oswitch.app.model;

import com.jcabi.jdbc.*;
import java.io.PrintStream;
import java.sql.*;
import java.util.ArrayList;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import com.ocularminds.oswitch.common.Identifier;
import com.ocularminds.oswitch.app.jdbc.JdbcSource;

public class Transactions {

    private JdbcSource source;
    private Logger logger;

    public Transactions() {
<span class="nc" id="L19">        this(new JdbcSource(&quot;edu_portal&quot;));</span>
<span class="nc" id="L20">    }</span>

<span class="nc" id="L22">    public Transactions(JdbcSource src) {</span>
<span class="nc" id="L23">        logger = Logger.getLogger(Transactions.class.getName());</span>
<span class="nc" id="L24">        source = src;</span>
<span class="nc" id="L25">    }</span>

    public Transaction get(String id) {
<span class="nc" id="L28">        Transaction transaction = new Transaction();</span>
        try {
<span class="nc" id="L30">            transaction =</span>
<span class="nc" id="L31">                    new JdbcSession(source.get())</span>
<span class="nc" id="L32">                            .sql(new StringBuilder(&quot;select tran_id, ref,typ,channel, &quot;)</span>
<span class="nc" id="L33">                                    .append(&quot;debit, credit, amount, narration,tran_dt, &quot;)</span>
<span class="nc" id="L34">                                    .append(&quot;beneficiary&quot;)</span>
<span class="nc" id="L35">                                    .append(&quot;from os_trans where tran_id = ?&quot;).toString()).set(id)</span>
<span class="nc" id="L36">                            .select(new Outcome&lt;Transaction&gt;() {</span>
                                public Transaction handle(ResultSet rs, Statement s)
                                        throws SQLException {
<span class="nc bnc" id="L39" title="All 2 branches missed.">                                    if (rs.next()) {</span>
<span class="nc" id="L40">                                        return read(rs);</span>
                                    } else {
<span class="nc" id="L42">                                        return null;</span>
                                    }
                                }
                            });
<span class="nc" id="L46">        } catch (Exception ex) {</span>
<span class="nc" id="L47">            logger.log(Level.SEVERE, &quot;Error selecting transaction &quot;, ex);</span>
<span class="nc" id="L48">        }</span>
<span class="nc" id="L49">        return transaction;</span>
    }

    public Transaction find(String name) {
<span class="nc" id="L53">        Transaction transaction = null;</span>
        try {
<span class="nc" id="L55">            transaction =</span>
<span class="nc" id="L56">                    new JdbcSession(source.get())</span>
<span class="nc" id="L57">                            .sql(new StringBuilder(&quot;select tran_id, ref,typ,channel, &quot;)</span>
<span class="nc" id="L58">                                    .append(&quot;debit, credit, amount, narration,tran_dt, &quot;)</span>
<span class="nc" id="L59">                                    .append(&quot;beneficiary&quot;)</span>
<span class="nc" id="L60">                                    .append(&quot;from os_trans where tran_id = ?&quot;).toString())</span>
<span class="nc" id="L61">                            .set(name).select(new Outcome&lt;Transaction&gt;() {</span>

                                public Transaction handle(ResultSet rs, Statement s)
                                        throws SQLException {
<span class="nc bnc" id="L65" title="All 2 branches missed.">                                    if (rs.next()) {</span>
<span class="nc" id="L66">                                        return read(rs);</span>
                                    } else {
<span class="nc" id="L68">                                        return null;</span>
                                    }
                                }
                            });
<span class="nc" id="L72">        } catch (Exception ex) {</span>
<span class="nc" id="L73">            logger.log(Level.SEVERE, &quot;Error selecting transaction &quot;, ex);</span>
<span class="nc" id="L74">        }</span>
<span class="nc" id="L75">        return transaction;</span>
    }

    public void add(Transaction transaction) {
        try {
<span class="nc" id="L80">            new JdbcSession(source.get())</span>
<span class="nc" id="L81">                    .sql(new StringBuilder(&quot;INSERT INTO os_tran(&quot;)</span>
<span class="nc" id="L82">                            .append(&quot;tran_id, ref,typ,channel, &quot;)</span>
<span class="nc" id="L83">                            .append(&quot;debit, credit, amount, narration,tran_dt, &quot;)</span>
<span class="nc" id="L84">                            .append(&quot;beneficiary) VALUES(&quot;).append(&quot;?,?,?,?,?,?,?,?,?)&quot;).toString())</span>
<span class="nc" id="L85">                    .set(new Identifier().next()).set(transaction.getReference())</span>
<span class="nc" id="L86">                    .set(transaction.getType().toString()).set(transaction.getChannel().toString())</span>
<span class="nc" id="L87">                    .set(transaction.getDebit()).set(transaction.getCredit())</span>
<span class="nc" id="L88">                    .set(transaction.getAmount()).set(transaction.getNarration())</span>
<span class="nc" id="L89">                    .set(new java.sql.Date(new java.util.Date().getTime()))</span>
<span class="nc" id="L90">                    .set(transaction.getBeneficiary()).insert(Outcome.VOID);</span>
<span class="nc" id="L91">        } catch (Exception ex) {</span>
<span class="nc" id="L92">            logger.log(Level.SEVERE, &quot;error saving transaction!&quot;, ex);</span>
<span class="nc" id="L93">        }</span>
<span class="nc" id="L94">    }</span>

    public final List&lt;Transaction&gt; iterate() {
<span class="nc" id="L97">        List&lt;Transaction&gt; records = new ArrayList&lt;&gt;();</span>
        try {
<span class="nc" id="L99">            records =</span>
<span class="nc" id="L100">                    new JdbcSession(source.get()).sql(</span>
                            new StringBuilder(&quot;select tran_id, ref,typ,channel, &quot;)
<span class="nc" id="L102">                                    .append(&quot;debit, credit, amount, narration,tran_dt, &quot;)</span>
<span class="nc" id="L103">                                    .append(&quot;beneficiary&quot;).append(&quot;from os_trans&quot;).toString())</span>
<span class="nc" id="L104">                            .select(new Outcome&lt;List&lt;Transaction&gt;&gt;() {</span>
                                @Override
                                public List&lt;Transaction&gt; handle(ResultSet rs, Statement st)
                                        throws SQLException {
<span class="nc" id="L108">                                    final List&lt;Transaction&gt; records = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">                                    while (rs.next()) {</span>
<span class="nc" id="L110">                                        records.add(read(rs));</span>
                                    }
<span class="nc" id="L112">                                    return records;</span>
                                }
                            });
<span class="nc" id="L115">        } catch (Exception ex) {</span>
<span class="nc" id="L116">            logger.log(Level.SEVERE, null, ex);</span>
<span class="nc" id="L117">        }</span>
<span class="nc" id="L118">        return records;</span>
    }

    public Transaction read(ResultSet rs) {
<span class="nc" id="L122">        Transaction transaction = new Transaction();</span>
        try {
<span class="nc" id="L124">            String id = rs.getString(&quot;tran_id&quot;);</span>
<span class="nc" id="L125">            String ref = rs.getString(&quot;ref&quot;);</span>
<span class="nc" id="L126">            String type = rs.getString(&quot;typ&quot;);</span>
<span class="nc" id="L127">            String channel = rs.getString(&quot;channel&quot;);</span>
<span class="nc" id="L128">            String debit = rs.getString(&quot;debit&quot;);</span>
<span class="nc" id="L129">            String credit = rs.getString(&quot;credit&quot;);</span>
<span class="nc" id="L130">            double amount = rs.getDouble(&quot;amount&quot;);</span>
<span class="nc" id="L131">            String narration = rs.getString(&quot;narration&quot;);</span>
<span class="nc" id="L132">            Date date = rs.getDate(&quot;tran_dt&quot;);</span>
<span class="nc" id="L133">            String beneficiary = rs.getString(&quot;beneficiary&quot;);</span>
<span class="nc" id="L134">            transaction.setId(id);</span>
<span class="nc" id="L135">            transaction.setReference(ref);</span>
            // transaction.setType(Transaction.Type.valueOf(type));
<span class="nc" id="L137">            transaction.setChannel(Transaction.Channel.valueOf(channel));</span>
<span class="nc" id="L138">            transaction.setDebit(debit);</span>
<span class="nc" id="L139">            transaction.setCredit(credit);</span>
<span class="nc" id="L140">            transaction.setAmount(amount);</span>
<span class="nc" id="L141">            transaction.setNarration(narration);</span>
<span class="nc" id="L142">            transaction.setDate(date);</span>
<span class="nc" id="L143">        } catch (Exception ex) {</span>
<span class="nc" id="L144">            logger.log(Level.SEVERE, null, ex);</span>
<span class="nc" id="L145">        }</span>
<span class="nc" id="L146">        return transaction;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>